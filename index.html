<!DOCTYPE html>
<html lang="pl">
<head>
  <link rel="icon" type="image/png" href="favicon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SP57</title>
  <style>
    /* (Pozostaw styl bez zmian) */
  </style>
</head>
<body>
  <div id="header-container">
    <h1>
      <img src="https://cdn-icons-png.flaticon.com/512/5310/5310672.png" class="icon" alt="Edukacja" />
      Szkoła Podstawowa nr 57 we Wrocławiu
    </h1>
    <input type="text" id="search" placeholder="Wyszukaj ogłoszenia..." oninput="wyszukajOgloszenia()" />
  </div>

  <div id="menu">
    <!-- (Pozostaw menu bez zmian) -->
  </div>

  <div id="ogloszenia"></div>

  <script>
    // ZMIANA: Wstawiłem Twój klucz API i Bin ID
    const apiKey = '$2a$10$Lrw8dNmqRfLDVzjI22oysONmVE3Sur/E4RYw8ZE7DRFpt/nRuzLKG'; // Twój X-Master-Key
    const binId = '67b8d2edacd3cb34a8eb7f1e'; // Twój Bin ID
    const apiUrl = `https://api.jsonbin.io/v3/b/${binId}`;

    // ZMIANA: Funkcja do pobierania danych z JSONBin.io
    async function pobierzDane() {
      try {
        const response = await fetch(apiUrl, {
          headers: {
            'X-Master-Key': apiKey,
          },
        });
        const data = await response.json();
        return data.record || {
          ogolne: [],
          samorzad: [],
          wycieczki: [],
          nieobecnosci: [],
          przedmioty: [],
          swietlica: [],
          wydarzenia: [],
          grono: [],
          wychowawcy: [
            { klasa: '1a', wychowawca: 'Jolanta Bosak' },
            { klasa: '1b', wychowawca: 'Rozalia Lipska' },
            { klasa: '1c', wychowawca: 'Faustyna Dobrzek' },
            { klasa: '2a', wychowawca: 'Alicja Rajewicz-Drzemała' },
            { klasa: '2b', wychowawca: 'Agnieszka Miłasz' },
            { klasa: '2c', wychowawca: 'Daria Musherina' },
            { klasa: '3a', wychowawca: 'Katarzyna Buzdro' },
            { klasa: '3b', wychowawca: 'Anna Brzeska' },
            { klasa: '3c', wychowawca: 'Danuta Kapciuszko' },
            { klasa: '4a', wychowawca: 'Renata Skleszewska' },
            { klasa: '4b', wychowawca: 'Mateusz Gigołła' },
            { klasa: '4c', wychowawca: 'Natalia Raczynska' },
            { klasa: '5a', wychowawca: 'Katarzyna Sieczko' },
            { klasa: '5b', wychowawca: 'Dorota Maszkiewska*' },
            { klasa: '5m', wychowawca: 'Antonina Pawelczyk' },
            { klasa: '6a', wychowawca: 'Bożena Szpilkiewicz' },
            { klasa: '6b', wychowawca: 'Kinga Młodzik' },
            { klasa: '6m', wychowawca: 'Małgorzata Domagała' },
            { klasa: '7a', wychowawca: 'Celina Włodarczyk' },
            { klasa: '7b', wychowawca: 'Magdalena Joelesh' },
            { klasa: '7m', wychowawca: 'Ewelina Śmigalska' },
            { klasa: '8a', wychowawca: 'Karol Dębowicz' },
            { klasa: '8b', wychowawca: 'Michał Tarczyn' },
            { klasa: '8m', wychowawca: 'Ludwik Parkowiak' }
          ],
          dlaNauczyciela: []
        };
      } catch (error) {
        console.error('Błąd podczas pobierania danych:', error);
        return {
          ogolne: [],
          samorzad: [],
          wycieczki: [],
          nieobecnosci: [],
          przedmioty: [],
          swietlica: [],
          wydarzenia: [],
          grono: [],
          wychowawcy: [
            { klasa: '1a', wychowawca: 'Jolanta Bosak' },
            { klasa: '1b', wychowawca: 'Rozalia Lipska' },
            { klasa: '1c', wychowawca: 'Faustyna Dobrzek' },
            { klasa: '2a', wychowawca: 'Alicja Rajewicz-Drzemała' },
            { klasa: '2b', wychowawca: 'Agnieszka Miłasz' },
            { klasa: '2c', wychowawca: 'Daria Musherina' },
            { klasa: '3a', wychowawca: 'Katarzyna Buzdro' },
            { klasa: '3b', wychowawca: 'Anna Brzeska' },
            { klasa: '3c', wychowawca: 'Danuta Kapciuszko' },
            { klasa: '4a', wychowawca: 'Renata Skleszewska' },
            { klasa: '4b', wychowawca: 'Mateusz Gigołła' },
            { klasa: '4c', wychowawca: 'Natalia Raczynska' },
            { klasa: '5a', wychowawca: 'Katarzyna Sieczko' },
            { klasa: '5b', wychowawca: 'Dorota Maszkiewska*' },
            { klasa: '5m', wychowawca: 'Antonina Pawelczyk' },
            { klasa: '6a', wychowawca: 'Bożena Szpilkiewicz' },
            { klasa: '6b', wychowawca: 'Kinga Młodzik' },
            { klasa: '6m', wychowawca: 'Małgorzata Domagała' },
            { klasa: '7a', wychowawca: 'Celina Włodarczyk' },
            { klasa: '7b', wychowawca: 'Magdalena Joelesh' },
            { klasa: '7m', wychowawca: 'Ewelina Śmigalska' },
            { klasa: '8a', wychowawca: 'Karol Dębowicz' },
            { klasa: '8b', wychowawca: 'Michał Tarczyn' },
            { klasa: '8m', wychowawca: 'Ludwik Parkowiak' }
          ],
          dlaNauczyciela: []
        };
      }
    }

    // ZMIANA: Funkcja do zapisywania danych w JSONBin.io
    async function zapiszDane(dane) {
      try {
        await fetch(apiUrl, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': apiKey,
          },
          body: JSON.stringify(dane),
        });
      } catch (error) {
        console.error('Błąd podczas zapisywania danych:', error);
      }
    }

    // ZMIANA: Inicjalizacja danych
    let ogloszenia;
    async function inicjalizuj() {
      ogloszenia = await pobierzDane();
      pokazOgloszenia('ogolne'); // Domyślnie pokazujemy ogłoszenia ogólne
      zaladujMenu();
    }

    // Funkcja do ładowania menu
    function zaladujMenu() {
      const menu = document.getElementById("menu");
      menu.innerHTML = `
        <button onclick="pokazOgloszenia('ogolne')">
          <img src="https://cdn-icons-png.flaticon.com/512/107/107812.png" class="category-icon" alt="Ogólne" /> Ogólne
        </button>
        <button onclick="pokazOgloszenia('nieobecnosci')">
          <img src="https://img.myloview.pl/fototapety/vector-sars-virus-flat-icon-vector-pictograph-style-is-a-flat-symbol-sars-virus-icon-on-a-white-background-700-205263154.jpg" class="category-icon" alt="Nieobecności nauczycieli" /> Nieobecności nauczycieli
        </button>
        <button onclick="pokazOgloszenia('wydarzenia')">
          <img src="https://static.vecteezy.com/system/resources/previews/006/692/012/non_2x/calendar-date-date-notes-business-office-event-icon-template-black-color-editable-calendar-date-symbol-flat-illustration-for-graphic-and-web-design-free-vector.jpg" class="category-icon" alt="Wydarzenia" /> Wydarzenia
        </button>
        <button onclick="pokazOgloszenia('samorzad')">
          <img src="https://spfalkowo.pl/images/glowne/260-4620.png" class="category-icon" alt="Samorząd Uczniowski i Wolontariat" /> Samorząd Uczniowski i Wolontariat
        </button>
        <button onclick="pokazOgloszenia('wycieczki')">
          <img src="https://cdn-icons-png.freepik.com/512/5776/5776883.png" class="category-icon" alt="Wycieczki" /> Wycieczki
        </button>
        <button onclick="pokazOgloszenia('swietlica')">
          <img src="https://czasopismomatematyka.pl/media/cache/img_370_251/uploads/673/455/673455e2199b4989535024.webp?extension=jpg&version=609" class="category-icon" alt="Klasy 1-3, Świetlica" /> Klasy 1-3, Świetlica
        </button>
        <button onclick="pokazOgloszenia('grono')">
          <img src="https://cdn-icons-png.flaticon.com/512/2472/2472253.png" class="category-icon" alt="Grono Pedagogiczne" /> Grono Pedagogiczne
        </button>
        <button onclick="pokazOgloszenia('wychowawcy')">
          <img src="https://cdn-icons-png.flaticon.com/512/1995/1995574.png" class="category-icon" alt="Wychowawcy" /> Wychowawcy
        </button>
        <button onclick="pokazLibrus()">
          <img src="https://cdn-icons-png.flaticon.com/512/3652/3652191.png" class="category-icon" alt="Harmonogram Świetlicy" /> Harmonogram Świetlicy
        </button>
        <button onclick="pokazOgloszenia('przedmioty')">
          <img src="https://cdn-icons-png.flaticon.com/512/2922/2922561.png" class="category-icon" alt="Przedmioty" /> Przedmioty
        </button>
        <button onclick="pokazOgloszenia('dlaNauczyciela')">
          <img src="https://cdn-icons-png.flaticon.com/512/2922/2922510.png" class="category-icon" alt="Dla Nauczyciela" /> Dla Nauczyciela
        </button>
      `;
    }

    // Funkcja wyświetlająca ogłoszenia dla wybranej kategorii
    async function pokazOgloszenia(kategoria) {
      const ogloszeniaDiv = document.getElementById("ogloszenia");
      ogloszeniaDiv.innerHTML = "";

      if (kategoria === 'wychowawcy') {
        let tabela = "<table><tr><th>Klasa</th><th>Wychowawca</th></tr>";
        ogloszenia.wychowawcy.forEach(w => {
          tabela += `<tr><td>${w.klasa}</td><td>${w.wychowawca}</td></tr>`;
        });
        tabela += "</table>";
        ogloszeniaDiv.innerHTML = tabela;
      } else {
        ogloszenia[kategoria].forEach((o, index) => {
          const div = document.createElement("div");
          div.classList.add("ogloszenie");
          div.innerHTML = `<strong>${o.tytul}</strong>
                           <p>${o.tresc}</p>
                           <p><small>${formatujDate(o.data)}</small></p>
                           <span class='edytuj' onclick='edytujOgloszenie("${kategoria}", ${index})'>✏️</span>
                           <span class='usun' onclick='usunOgloszenie("${kategoria}", ${index})'>❌</span>
                           <span class='przesun-gore' onclick='przesunOgloszenie("${kategoria}", ${index}, "gore")'>⬆️</span>
                           <span class='przesun-dol' onclick='przesunOgloszenie("${kategoria}", ${index}, "dol")'>⬇️</span>`;
          ogloszeniaDiv.appendChild(div);
        });
      }

      // Dodajemy przycisk do dodawania ogłoszenia
      const addButton = document.createElement("button");
      addButton.classList.add("dodaj");
      addButton.textContent = "Dodaj ogłoszenie";
      addButton.onclick = () => dodajOgloszenie(kategoria);
      ogloszeniaDiv.appendChild(addButton);
    }

    // Funkcja wyszukująca ogłoszenia
    function wyszukajOgloszenia() {
      const searchQuery = document.getElementById("search").value.toLowerCase();
      const ogloszeniaDiv = document.getElementById("ogloszenia");
      ogloszeniaDiv.innerHTML = "";

      Object.keys(ogloszenia).forEach(kategoria => {
        ogloszenia[kategoria].forEach((o, index) => {
          if (o.tytul && o.tresc) {
            if (
              o.tytul.toLowerCase().includes(searchQuery) ||
              o.tresc.toLowerCase().includes(searchQuery)
            ) {
              const div = document.createElement("div");
              div.classList.add("ogloszenie");
              div.innerHTML = `<strong>${o.tytul}</strong>
                               <p>${o.tresc}</p>
                               <p><small>${formatujDate(o.data)}</small></p>
                               <span class='edytuj' onclick='edytujOgloszenie("${kategoria}", ${index})'>✏️</span>
                               <span class='usun' onclick='usunOgloszenie("${kategoria}", ${index})'>❌</span>
                               <span class='przesun-gore' onclick='przesunOgloszenie("${kategoria}", ${index}, "gore")'>⬆️</span>
                               <span class='przesun-dol' onclick='przesunOgloszenie("${kategoria}", ${index}, "dol")'>⬇️</span>`;
              ogloszeniaDiv.appendChild(div);
            }
          }
        });
      });
    }

    // Funkcja do dodawania ogłoszenia
    async function dodajOgloszenie(kategoria) {
      const tytul = prompt("Podaj tytuł ogłoszenia:");
      const tresc = prompt("Podaj treść ogłoszenia:");
      const data = new Date();
      if (tytul && tresc) {
        ogloszenia[kategoria].push({ tytul, tresc, data: data.toISOString() });
        await zapiszDane(ogloszenia);
        pokazOgloszenia(kategoria);
      }
    }

    // Funkcja do edycji ogłoszenia
    async function edytujOgloszenie(kategoria, index) {
      const tytul = prompt("Edytuj tytuł", ogloszenia[kategoria][index].tytul);
      const tresc = prompt("Edytuj treść", ogloszenia[kategoria][index].tresc);
      if (tytul && tresc) {
        ogloszenia[kategoria][index].tytul = tytul;
        ogloszenia[kategoria][index].tresc = tresc;
        await zapiszDane(ogloszenia);
        pokazOgloszenia(kategoria);
      }
    }

    // Funkcja do usuwania ogłoszenia
    async function usunOgloszenie(kategoria, index) {
      if (confirm("Czy na pewno chcesz usunąć to ogłoszenie?")) {
        ogloszenia[kategoria].splice(index, 1);
        await zapiszDane(ogloszenia);
        pokazOgloszenia(kategoria);
      }
    }

    // Funkcja do przesuwania ogłoszeń
    async function przesunOgloszenie(kategoria, index, kierunek) {
      if (kierunek === "gore" && index > 0) {
        [ogloszenia[kategoria][index], ogloszenia[kategoria][index - 1]] =
          [ogloszenia[kategoria][index - 1], ogloszenia[kategoria][index]];
      } else if (kierunek === "dol" && index < ogloszenia[kategoria].length - 1) {
        [ogloszenia[kategoria][index], ogloszenia[kategoria][index + 1]] =
          [ogloszenia[kategoria][index + 1], ogloszenia[kategoria][index]];
      }
      await zapiszDane(ogloszenia);
      pokazOgloszenia(kategoria);
    }

    // Funkcja formatująca datę
    function formatujDate(isoString) {
      const date = new Date(isoString);
      const now = new Date();
      const diffSeconds = Math.floor((now - date) / 1000);

      if (diffSeconds < 60) {
        return diffSeconds + " sekund temu";
      }
      const diffMinutes = Math.floor(diffSeconds / 60);
      if (diffMinutes < 60) {
        return diffMinutes + " minut temu";
      }
      const diffHours = Math.floor(diffMinutes / 60);
      if (diffHours < 24) {
        return diffHours + " godzin temu";
      }
      const diffDays = Math.floor(diffHours / 24);
      return diffDays + " dni temu";
    }

    // Inicjalizacja strony
    inicjalizuj();
  </script>
</body>
</html>
