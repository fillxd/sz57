<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SP 57 Ogłoszenia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .category-btn {
            padding: 10px 20px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .category-btn:hover {
            background-color: #45a049;
        }
        #announcement-list {
            margin-top: 20px;
        }
        .announcement {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
        }
        .announcement button {
            background-color: red;
            color: white;
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .announcement button:hover {
            background-color: darkred;
        }
    </style>
</head>
<body>

    <h1>Ogłoszenia SP 57</h1>

    <div>
        <button class="category-btn" onclick="showSection('general')">Ogólne</button>
        <button class="category-btn" onclick="showSection('absences')">Nieobecności</button>
        <button class="category-btn" onclick="showSection('events')">Wydarzenia</button>
    </div>

    <div id="announcement-list"></div>
    <button class="category-btn" onclick="dodajOgloszenie()">Dodaj ogłoszenie</button>

    <!-- Firebase setup (make sure this is included) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBWhG0j-ufWPNk7eBvJWtFPB1J661AzrrQ",
            authDomain: "sp-eb58b.firebaseapp.com",
            databaseURL: "https://sp-eb58b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "sp-eb58b",
            storageBucket: "sp-eb58b.firebasestorage.app",
            messagingSenderId: "721683903483",
            appId: "1:721683903483:web:871ef96ee6957e7f3e515e",
            measurementId: "G-2BJ1JK7D4H"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database(app);

        let currentCategory = 'general';  // default category

        // Show category section
        function showSection(section) {
            console.log(`Switching to section: ${section}`);
            currentCategory = section;
            pobierzOgloszenia(section);
        }

        // Pobierz ogłoszenia z Firebase
        function pobierzOgloszenia(sectionId) {
            const ogloszeniaRef = firebase.database().ref(`${sectionId}`);
            ogloszeniaRef.on('value', (snapshot) => {
                const ogloszenia = snapshot.val();
                console.log("Ogłoszenia:", ogloszenia);
                displayAnnouncements(ogloszenia, sectionId);
            });
        }

        // Wyświetl ogłoszenia na stronie
        function displayAnnouncements(ogloszenia, sectionId) {
            const listElement = document.getElementById('announcement-list');
            listElement.innerHTML = '';  // Clear the existing list

            if (ogloszenia) {
                for (const id in ogloszenia) {
                    const announcement = ogloszenia[id];
                    const announcementElement = document.createElement('div');
                    announcementElement.classList.add('announcement');
                    announcementElement.innerHTML = `
                        <h3>${announcement.title}</h3>
                        <p>${announcement.content}</p>
                        <button onclick="usuwanieOgloszenia('${sectionId}', '${id}')">Usuń</button>
                    `;
                    listElement.appendChild(announcementElement);
                }
            } else {
                listElement.innerHTML = '<p>Brak ogłoszeń w tej kategorii.</p>';
            }
        }

        // Dodaj ogłoszenie
        function dodajOgloszenie() {
            const title = prompt('Podaj tytuł ogłoszenia:');
            if (!title) return;

            const content = prompt('Podaj treść ogłoszenia:');
            if (!content) return;

            const newAnnouncement = {
                title: title,
                content: content
            };

            const ogloszeniaRef = firebase.database().ref(`${currentCategory}`);
            const newPostRef = ogloszeniaRef.push();
            newPostRef.set(newAnnouncement)
                .then(() => {
                    console.log('Ogłoszenie zostało dodane');
                    pobierzOgloszenia(currentCategory);  // Reload announcements
                })
                .catch((error) => {
                    console.error("Error adding announcement:", error);
                });
        }

        // Usuń ogłoszenie
        function usuwanieOgloszenia(sectionId, ogloszenieId) {
            const ogloszenieRef = firebase.database().ref(`${sectionId}/${ogloszenieId}`);
            ogloszenieRef.remove()
                .then(() => {
                    console.log('Ogłoszenie zostało usunięte');
                    pobierzOgloszenia(sectionId);  // Reload announcements
                })
                .catch((error) => {
                    console.error('Błąd podczas usuwania ogłoszenia:', error);
                });
        }

        // Pobierz ogłoszenia przy starcie
        window.onload = function() {
            console.log("Strona załadowana!");
            pobierzOgloszenia(currentCategory);  // Load announcements for default category
        }
    </script>
</body>
</html>
