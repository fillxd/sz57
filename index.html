<!DOCTYPE html>
<html lang="pl">
<head>
<link rel="icon" type="image/png" href="favicon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SP57</title>
  <!-- Dodaj Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    /* ... (styl pozostaje bez zmian) ... */
  </style>
</head>
<body>
  <!-- ... (HTML pozostaje bez zmian) ... -->

  <script>
    // Konfiguracja Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBWhG0j-ufWPNk7eBvJWtFPB1J661AzrrQ",
      authDomain: "sp-eb58b.firebaseapp.com",
      databaseURL: "https://sp-eb58b-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "sp-eb58b",
      storageBucket: "sp-eb58b.firebasestorage.app",
      messagingSenderId: "721683903483",
      appId: "1:721683903483:web:871ef96ee6957e7f3e515e",
      measurementId: "G-2BJ1JK7D4H"
    };

    // Inicjalizacja Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ogloszeniaRef = db.ref('ogloszenia');

    let ogloszenia = {};
    let currentCategory = 'ogolne';

    // Nasłuchiwanie zmian w bazie danych
    ogloszeniaRef.on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        ogloszenia = data;
        pokazOgloszenia(currentCategory);
      } else {
        // Inicjalizacja danych domyślnych
        const defaultData = {
          ogolne: [],
          samorzad: [],
          wycieczki: [],
          nieobecnosci: [],
          przedmioty: [],
          swietlica: [],
          wydarzenia: [],
          grono: [],
          wychowawcy: [
            { klasa: '1a', wychowawca: 'Jolanta Bosak' },
            // ... (reszta danych inicjalizacyjnych)
          ],
          dlaNauczyciela: []
        };
        ogloszeniaRef.set(defaultData);
      }
    });

    function pokazOgloszenia(kategoria) {
      currentCategory = kategoria;
      const ogloszeniaDiv = document.getElementById("ogloszenia");
      ogloszeniaDiv.innerHTML = "";

      if (kategoria === 'wychowawcy') {
        let tabela = "<table><tr><th>Klasa</th><th>Wychowawca</th></tr>";
        ogloszenia.wychowawcy.forEach(w => {
          tabela += `<tr><td>${w.klasa}</td><td>${w.wychowawca}</td></tr>`;
        });
        tabela += "</table>";
        ogloszeniaDiv.innerHTML = tabela;
      } else {
        const kategoriaData = ogloszenia[kategoria] || [];
        kategoriaData.forEach((o, index) => {
          const div = document.createElement("div");
          div.classList.add("ogloszenie");
          div.innerHTML = `<strong>${o.tytul}</strong>
                           <p>${o.tresc}</p>
                           ${o.data ? `<p><small>${formatujDate(o.data)}</small></p>` : ''}
                           <span class='edytuj' onclick='edytujOgloszenie("${kategoria}", ${index})'>✏️</span>
                           <span class='usun' onclick='usunOgloszenie("${kategoria}", ${index})'>❌</span>
                           <span class='przesun-gore' onclick='przesunOgloszenie("${kategoria}", ${index}, "gore")'>⬆️</span>
                           <span class='przesun-dol' onclick='przesunOgloszenie("${kategoria}", ${index}, "dol")'>⬇️</span>`;
          ogloszeniaDiv.appendChild(div);
        });
      }

      const addButton = document.createElement("button");
      addButton.className = "dodaj";
      addButton.textContent = "Dodaj ogłoszenie";
      addButton.onclick = () => dodajOgloszenie(kategoria);
      ogloszeniaDiv.appendChild(addButton);
    }

    // Zmodyfikowane funkcje operujące na Firebase
    function dodajOgloszenie(kategoria) {
      const tytul = prompt("Podaj tytuł ogłoszenia:");
      const tresc = prompt("Podaj treść ogłoszenia:");
      const data = new Date().toISOString();
      
      if (tytul && tresc) {
        const newOgloszenie = { tytul, tresc, data };
        db.ref(`ogloszenia/${kategoria}`).transaction((currentData) => {
          if (currentData === null) return [newOgloszenie];
          return [...currentData, newOgloszenie];
        });
      }
    }

    function edytujOgloszenie(kategoria, index) {
      const ref = db.ref(`ogloszenia/${kategoria}/${index}`);
      ref.once('value').then((snapshot) => {
        const ogloszenie = snapshot.val();
        const tytul = prompt("Edytuj tytuł", ogloszenie.tytul);
        const tresc = prompt("Edytuj treść", ogloszenie.tresc);
        
        if (tytul && tresc) {
          ref.update({ tytul, tresc });
        }
      });
    }

    function usunOgloszenie(kategoria, index) {
      if (confirm("Czy na pewno chcesz usunąć to ogłoszenie?")) {
        db.ref(`ogloszenia/${kategoria}`).transaction((currentData) => {
          if (currentData && currentData.length > index) {
            currentData.splice(index, 1);
          }
          return currentData;
        });
      }
    }

    function przesunOgloszenie(kategoria, index, kierunek) {
      const ref = db.ref(`ogloszenia/${kategoria}`);
      ref.transaction((currentData) => {
        if (!currentData) return currentData;
        
        if (kierunek === "gore" && index > 0) {
          [currentData[index], currentData[index - 1]] = 
          [currentData[index - 1], currentData[index]];
        } else if (kierunek === "dol" && index < currentData.length - 1) {
          [currentData[index], currentData[index + 1]] = 
          [currentData[index + 1], currentData[index]];
        }
        return currentData;
      });
    }

    // ... (pozostałe funkcje pozostają bez zmian) ...
  </script>
</body>
</html>
